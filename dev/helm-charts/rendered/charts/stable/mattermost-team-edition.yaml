---
# Source: mattermost-team-edition/charts/mysql/templates/secrets.yaml

apiVersion: v1
kind: Secret
metadata:
  name: RELEASE-NAME-mysql
  labels:
    app: RELEASE-NAME-mysql
    chart: "mysql-0.10.1"
    release: "RELEASE-NAME"
    heritage: "Tiller"
type: Opaque
data:
  
  mysql-root-password: "NnNxVEVMTHFzTA=="
  
  
  mysql-password: "aXBjbUJKY2JRWA=="
  
---
# Source: mattermost-team-edition/charts/mysql/templates/tests/test-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: RELEASE-NAME-mysql-test
  labels:
    app: RELEASE-NAME-mysql
    chart: "mysql-0.10.1"
    heritage: "Tiller"
    release: "RELEASE-NAME"
data:
  run.sh: |-


---
# Source: mattermost-team-edition/templates/configmap-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: RELEASE-NAME-mattermost-team-edition-config-json
  labels:
    chart: mattermost-team-edition-1.4.1
    app: RELEASE-NAME-mattermost-team-edition
    release: RELEASE-NAME
    heritage: Tiller
data:
  config.json: |
    
    {
        "ServiceSettings": {
            "SiteURL": "",
            "LicenseFileLocation": "",
            "ListenAddress": ":8065",
            "ConnectionSecurity": "",
            "TLSCertFile": "",
            "TLSKeyFile": "",
            "UseLetsEncrypt": false,
            "LetsEncryptCertificateCacheFile": "./config/letsencrypt.cache",
            "Forward80To443": false,
            "ReadTimeout": 300,
            "WriteTimeout": 300,
            "MaximumLoginAttempts": 10,
            "GoroutineHealthThreshold": -1,
            "GoogleDeveloperKey": "",
            "EnableOAuthServiceProvider": false,
            "EnableIncomingWebhooks": true,
            "EnableOutgoingWebhooks": true,
            "EnableCommands": true,
            "EnableOnlyAdminIntegrations": false,
            "EnablePostUsernameOverride": false,
            "EnablePostIconOverride": false,
            "EnableLinkPreviews": false,
            "EnableTesting": false,
            "EnableDeveloper": false,
            "EnableSecurityFixAlert": true,
            "EnableInsecureOutgoingConnections": false,
            "EnableMultifactorAuthentication": false,
            "EnforceMultifactorAuthentication": false,
            "AllowCorsFrom": "",
            "SessionLengthWebInDays": 30,
            "SessionLengthMobileInDays": 30,
            "SessionLengthSSOInDays": 30,
            "SessionCacheInMinutes": 10,
            "WebsocketSecurePort": 443,
            "WebsocketPort": 80,
            "WebserverMode": "gzip",
            "EnableCustomEmoji": false,
            "RestrictCustomEmojiCreation": "all",
            "RestrictPostDelete": "all",
            "AllowEditPost": "always",
            "PostEditTimeLimit": 300,
            "TimeBetweenUserTypingUpdatesMilliseconds": 5000,
            "EnablePostSearch": true,
            "EnableUserTypingMessages": true,
            "EnableUserStatuses": true,
            "ClusterLogTimeoutMilliseconds": 2000
        },
        "TeamSettings": {
            "SiteName": "Mattermost",
            "MaxUsersPerTeam": 50000,
            "EnableTeamCreation": true,
            "EnableUserCreation": true,
            "EnableOpenServer": true,
            "RestrictCreationToDomains": "",
            "EnableCustomBrand": false,
            "CustomBrandText": "",
            "CustomDescriptionText": "",
            "RestrictDirectMessage": "any",
            "RestrictTeamInvite": "all",
            "RestrictPublicChannelManagement": "all",
            "RestrictPrivateChannelManagement": "all",
            "RestrictPublicChannelCreation": "all",
            "RestrictPrivateChannelCreation": "all",
            "RestrictPublicChannelDeletion": "all",
            "RestrictPrivateChannelDeletion": "all",
            "RestrictPrivateChannelManageMembers": "all",
            "UserStatusAwayTimeout": 300,
            "MaxChannelsPerTeam": 50000,
            "MaxNotificationsPerChannel": 1000
        },
        "SqlSettings": {
            
            "DriverName": "mysql",
            "DataSource": ":@tcp(RELEASE-NAME-mysql:3306)/mattermost?charset=utf8mb4,utf8&readTimeout=30s&writeTimeout=30s",
            
            "DataSourceReplicas": [],
            "DataSourceSearchReplicas": [],
            "MaxIdleConns": 20,
            "MaxOpenConns": 35,
            "Trace": false,
            "AtRestEncryptKey": "faFjtwSSef84nIGhPiwnHPhefTDpq2Qj",
            "QueryTimeout": 30
        },
        "LogSettings": {
            "EnableConsole": true,
            "ConsoleLevel": "INFO",
            "EnableFile": true,
            "FileLevel": "INFO",
            "FileFormat": "",
            "FileLocation": "",
            "EnableWebhookDebugging": true,
            "EnableDiagnostics": true
        },
        "PasswordSettings": {
            "MinimumLength": 5,
            "Lowercase": false,
            "Number": false,
            "Uppercase": false,
            "Symbol": false
        },
        "FileSettings": {
            "EnableFileAttachments": true,
            "MaxFileSize": 52428800,
            
            "DriverName": "local",
            
            "Directory": "./data/",
            "EnablePublicLink": false,
            "PublicLinkSalt": "obzSfbUqVlcCgmAC6ZlYeNf5v86RvkGa",
            "ThumbnailWidth": 120,
            "ThumbnailHeight": 100,
            "PreviewWidth": 1024,
            "PreviewHeight": 0,
            "ProfileWidth": 128,
            "ProfileHeight": 128,
            "InitialFont": "luximbi.ttf",
            "AmazonS3AccessKeyId": "",
            "AmazonS3SecretAccessKey": "",
            "AmazonS3Bucket": "",
            "AmazonS3Region": "",
            "AmazonS3Endpoint": "s3.amazonaws.com",
            "AmazonS3SSL": false,
            "AmazonS3SignV2": false
        },
        "EmailSettings": {
            "EnableSignUpWithEmail": true,
            "EnableSignInWithEmail": true,
            "EnableSignInWithUsername": true,
            
            "SendEmailNotifications": false,
            
            "RequireEmailVerification": false,
            "FeedbackName": "",
            "FeedbackEmail": "",
            "FeedbackOrganization": "",
            "SMTPUsername": "",
            "SMTPPassword": "",
            
            "EnableSMTPAuth": false,
            
            "SMTPServer": "",
            "SMTPPort": "",
            "ConnectionSecurity": "",
            "InviteSalt": "UIwNmZdddcfi6T9OzoHmIqVmzLKi6Jlu",
            "SendPushNotifications": true,
            "PushNotificationServer": "https://push.mattermost.com",
            "PushNotificationContents": "generic",
            "EnableEmailBatching": false,
            "EmailBatchingBufferSize": 256,
            "EmailBatchingInterval": 30,
            "SkipServerCertificateVerification": false
        },
        "RateLimitSettings": {
            "Enable": false,
            "PerSec": 10,
            "MaxBurst": 100,
            "MemoryStoreSize": 10000,
            "VaryByRemoteAddr": true,
            "VaryByHeader": ""
        },
        "PrivacySettings": {
            "ShowEmailAddress": true,
            "ShowFullName": true
        },
        "SupportSettings": {
            "TermsOfServiceLink": "https://about.mattermost.com/default-terms/",
            "PrivacyPolicyLink": "https://about.mattermost.com/default-privacy-policy/",
            "AboutLink": "https://about.mattermost.com/default-about/",
            "HelpLink": "https://about.mattermost.com/default-help/",
            "ReportAProblemLink": "https://about.mattermost.com/default-report-a-problem/",
            "SupportEmail": "feedback@mattermost.com"
        },
        "AnnouncementSettings": {
            "EnableBanner": false,
            "BannerText": "",
            "BannerColor": "#f2a93b",
            "BannerTextColor": "#333333",
            "AllowBannerDismissal": true
        },
    
        "LocalizationSettings": {
            "DefaultServerLocale": "en",
            "DefaultClientLocale": "en",
            "AvailableLocales": ""
        },
        "NativeAppSettings": {
            "AppDownloadLink": "https://about.mattermost.com/downloads/",
            "AndroidAppDownloadLink": "https://about.mattermost.com/mattermost-android-app/",
            "IosAppDownloadLink": "https://about.mattermost.com/mattermost-ios-app/"
        },
        "AnalyticsSettings": {
            "MaxUsersForStatistics": 2500
        },
        "WebrtcSettings": {
            "Enable": false,
            "GatewayWebsocketUrl": "",
            "GatewayAdminUrl": "",
            "GatewayAdminSecret": "",
            "StunURI": "",
            "TurnURI": "",
            "TurnUsername": "",
            "TurnSharedKey": ""
        },
        "DisplaySettings": {
            "CustomUrlSchemes": [],
            "ExperimentalTimezone": true
        },
        "TimezoneSettings": {
            "SupportedTimezonesPath": "timezones.json"
        },
        "PluginSettings": {
            "Enable": true,
            "EnableUploads": true,
            "Directory": "./plugins",
            "ClientDirectory": "./client/plugins",
            "Plugins": {},
            "PluginStates": {}
        }
    }
    

---
# Source: mattermost-team-edition/templates/tests/mattermost-config-test.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: RELEASE-NAME-mattermost-team-edition-tests
  labels:
    chart: mattermost-team-edition-1.4.1
    app: RELEASE-NAME-mattermost-team-edition
    release: RELEASE-NAME
    heritage: Tiller
data:
  run.sh: |-
    @test "Testing Mattermost is accessible" {
      curl --retry 48 --retry-delay 10 mattermost-team-edition.hub.svc.cluster.local:8065
    }

---
# Source: mattermost-team-edition/charts/mysql/templates/pvc.yaml

kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: RELEASE-NAME-mysql
  labels:
    app: RELEASE-NAME-mysql
    chart: "mysql-0.10.1"
    release: "RELEASE-NAME"
    heritage: "Tiller"
spec:
  accessModes:
    - "ReadWriteOnce"
  resources:
    requests:
      storage: "10Gi"

---
# Source: mattermost-team-edition/templates/pvc.yaml

kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: RELEASE-NAME-mattermost-team-edition
  labels:
    chart: mattermost-team-edition-1.4.1
    app: RELEASE-NAME-mattermost-team-edition
    release: RELEASE-NAME
    heritage: Tiller
  annotations:
  
spec:
  accessModes:
  - "ReadWriteOnce"
  resources:
    requests:
      storage: "10Gi"



---
# Source: mattermost-team-edition/charts/mysql/templates/svc.yaml
apiVersion: v1
kind: Service
metadata:
  name: RELEASE-NAME-mysql
  labels:
    app: RELEASE-NAME-mysql
    chart: "mysql-0.10.1"
    release: "RELEASE-NAME"
    heritage: "Tiller"
spec:
  type: ClusterIP
  ports:
  - name: mysql
    port: 3306
    targetPort: mysql
  selector:
    app: RELEASE-NAME-mysql

---
# Source: mattermost-team-edition/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: mattermost-team-edition
  labels:
    chart: mattermost-team-edition-1.4.1
    app: RELEASE-NAME-mattermost-team-edition
    release: RELEASE-NAME
    heritage: Tiller
spec:
  selector:
    app: RELEASE-NAME-mattermost-team-edition
    release: RELEASE-NAME
  type: ClusterIP
  ports:
  - port: 8065
    targetPort: 8065
    protocol: TCP
    name: mattermost-team-edition

---
# Source: mattermost-team-edition/charts/mysql/templates/tests/test.yaml
apiVersion: v1
kind: Pod
metadata:
  name: RELEASE-NAME-mysql-test
  labels:
    app: RELEASE-NAME-mysql
    chart: "mysql-0.10.1"
    heritage: "Tiller"
    release: "RELEASE-NAME"
  annotations:
    "helm.sh/hook": test-success
spec:
  initContainers:
    - name: test-framework
      image: dduportal/bats:0.4.0
      command:
      - "bash"
      - "-c"
      - |
        set -ex
        # copy bats to tools dir
        cp -R /usr/local/libexec/ /tools/bats/
      volumeMounts:
      - mountPath: /tools
        name: tools
  containers:
    - name: RELEASE-NAME-test
      image: "mysql:5.7.14"
      command: ["/tools/bats/bats", "-t", "/tests/run.sh"]
      volumeMounts:
      - mountPath: /tests
        name: tests
        readOnly: true
      - mountPath: /tools
        name: tools
  volumes:
  - name: tests
    configMap:
      name: RELEASE-NAME-mysql-test
  - name: tools
    emptyDir: {}
  restartPolicy: Never

---
# Source: mattermost-team-edition/templates/tests/mattermost-test.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "RELEASE-NAME-mattermost-team-edition-test-lnem5"
  labels:
    chart: mattermost-team-edition-1.4.1
    app: RELEASE-NAME-mattermost-team-edition
    release: RELEASE-NAME
    heritage: Tiller
  annotations:
    "helm.sh/hook": test-success
spec:
  initContainers:
  - name: "test-framework"
    image: "dduportal/bats:0.4.0"
    command:
    - "bash"
    - "-c"
    - |
      set -ex
      # copy bats to tools dir
      cp -R /usr/local/libexec/ /tools/bats/
    volumeMounts:
    - mountPath: /tools
      name: tools
  containers:
  - name: RELEASE-NAME-test
    image: "mattermost/mattermost-team-edition:5.5.0"
    command: ["/tools/bats/bats", "-t", "/tests/run.sh"]
    volumeMounts:
    - mountPath: /tests
      name: tests
      readOnly: true
    - mountPath: /tools
      name: tools
  volumes:
  - name: tests
    configMap:
      name: RELEASE-NAME-mattermost-team-edition-tests
  - name: tools
    emptyDir: {}
  restartPolicy: Never

---
# Source: mattermost-team-edition/charts/mysql/templates/deployment.yaml
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: RELEASE-NAME-mysql
  labels:
    app: RELEASE-NAME-mysql
    chart: "mysql-0.10.1"
    release: "RELEASE-NAME"
    heritage: "Tiller"
spec:
  template:
    metadata:
      labels:
        app: RELEASE-NAME-mysql
    spec:
      initContainers:
      - name: "remove-lost-found"
        image: "busybox:1.25.0"
        imagePullPolicy: "IfNotPresent"
        command:  ["rm", "-fr", "/var/lib/mysql/lost+found"]
        volumeMounts:
        - name: data
          mountPath: /var/lib/mysql
      # - name: do-something
      #   image: busybox
      #   command: ['do', 'something']
      
      containers:
      - name: RELEASE-NAME-mysql
        image: "mysql:5.7.14"
        imagePullPolicy: "IfNotPresent"
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: RELEASE-NAME-mysql
              key: mysql-root-password
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: RELEASE-NAME-mysql
              key: mysql-password
        - name: MYSQL_USER
          value: ""
        - name: MYSQL_DATABASE
          value: "mattermost"
        ports:
        - name: mysql
          containerPort: 3306
        livenessProbe:
          exec:
            command:
            - sh
            - -c
            - "mysqladmin ping -u root -p${MYSQL_ROOT_PASSWORD}"
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          exec:
            command:
            - sh
            - -c
            - "mysqladmin ping -u root -p${MYSQL_ROOT_PASSWORD}"
          initialDelaySeconds: 5
          periodSeconds: 10
          timeoutSeconds: 1
          successThreshold: 1
          failureThreshold: 3
        volumeMounts:
        - name: data
          mountPath: /var/lib/mysql
        # - name: extras
        #   mountPath: /usr/share/extras
        #   readOnly: true
        
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: RELEASE-NAME-mysql
      # - name: extras
      #   emptyDir: {}
      

---
# Source: mattermost-team-edition/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: RELEASE-NAME-mattermost-team-edition
  labels:
    chart: mattermost-team-edition-1.4.1
    app: RELEASE-NAME-mattermost-team-edition
    release: RELEASE-NAME
    heritage: Tiller
spec:
  replicas: 1
  strategy:
    type: Recreate
    rollingUpdate: null
  revisionHistoryLimit: 1
  selector:
    matchLabels:
      app: RELEASE-NAME-mattermost-team-edition
      release: RELEASE-NAME
  template:
    metadata:
      annotations:
        checksum/config: bdb948278fd17c439b03abdc003f3270b2b838cce04978e4c103994d93a12baf
      labels:
        app: RELEASE-NAME-mattermost-team-edition
        release: RELEASE-NAME
        chart: mattermost-team-edition-1.4.1
        heritage: Tiller
    spec:
      initContainers:
      - name: "init-mysql"
        image: "appropriate/curl:latest"
        imagePullPolicy: IfNotPresent
        command: ["sh", "-c", "until curl --max-time 5 http://RELEASE-NAME-mysql:3306; do echo waiting for RELEASE-NAME-mysql; sleep 5; done;"]
      containers:
      - name: mattermost-team-edition
        image: "mattermost/mattermost-team-edition:5.5.0"
        imagePullPolicy: IfNotPresent
        env:
        ports:
        - name: http
          containerPort: 80
          protocol: TCP
        livenessProbe:
          initialDelaySeconds: 90
          timeoutSeconds: 5
          periodSeconds: 15
          httpGet:
            path: /api/v4/system/ping
            port: 8065
        readinessProbe:
          initialDelaySeconds: 15
          timeoutSeconds: 5
          periodSeconds: 15
          httpGet:
            path: /api/v4/system/ping
            port: 8065
        volumeMounts:
        - mountPath: /mattermost/config/config.json
          name: config-json
          subPath: config.json
        - mountPath: /mattermost/data
          name: mattermost-data
        resources:
            null
            
      volumes:
      - name: config-json
        configMap:
          name: RELEASE-NAME-mattermost-team-edition-config-json
          items:
          - key: config.json
            path: config.json
      - name: mattermost-data
      
        persistentVolumeClaim:
          claimName: RELEASE-NAME-mattermost-team-edition
      

---
# Source: mattermost-team-edition/charts/mysql/templates/configurationFiles-configmap.yaml

---
# Source: mattermost-team-edition/charts/mysql/templates/initializationFiles-configmap.yaml

---
# Source: mattermost-team-edition/templates/config.tpl


---
# Source: mattermost-team-edition/templates/ingress.yaml



