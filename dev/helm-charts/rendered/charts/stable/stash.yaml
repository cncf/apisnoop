---
# Source: stash/templates/service-account.yaml

apiVersion: v1
kind: ServiceAccount
metadata:
  name: RELEASE-NAME-stash
  labels:
    chart: "stash-0.5.3"
    app: "stash"
    heritage: "Tiller"
    release: "RELEASE-NAME"


---
# Source: stash/templates/cluster-role.yaml

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: RELEASE-NAME-stash
  labels:
    chart: "stash-0.5.3"
    app: "stash"
    heritage: "Tiller"
    release: "RELEASE-NAME"
rules:
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - "*"
- apiGroups:
  - extensions
  resources:
  - thirdpartyresources
  verbs:
  - "*"
- apiGroups:
  - stash.appscode.com
  resources: ["*"]
  verbs: ["*"]
- apiGroups:
  - apps
  resources:
  - deployments
  - statefulsets
  verbs: ["get", "list", "watch", "patch"]
- apiGroups:
  - batch
  resources:
  - jobs
  - cronjobs
  verbs: ["get", "list", "watch", "create", "delete", "patch"]
- apiGroups:
  - extensions
  resources:
  - replicasets
  - daemonsets
  verbs: ["get", "list", "watch", "patch"]
- apiGroups: [""]
  resources:
  - namespaces
  - replicationcontrollers
  verbs: ["get", "list", "watch", "patch"]
- apiGroups: [""]
  resources:
  - configmaps
  verbs: ["create", "update", "get", "delete"]
- apiGroups: [""]
  resources:
  - secrets
  verbs: ["get"]
- apiGroups: [""]
  resources:
  - events
  verbs: ["create"]
- apiGroups: [""]
  resources:
  - nodes
  verbs: ["list"]
- apiGroups: [""]
  resources:
  - pods
  verbs: ["get", "create", "list", "delete", "deletecollection"]
- apiGroups: [""]
  resources:
  - serviceaccounts
  verbs: ["get", "create", "patch", "delete"]
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterroles
  - roles
  - rolebindings
  verbs: ["get", "create", "delete", "patch"]


---
# Source: stash/templates/user-roles.yaml

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: appscode:stash:edit
  labels:
    rbac.authorization.k8s.io/aggregate-to-admin: "true"
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
rules:
- apiGroups:
  - stash.appscode.com
  resources:
  - restics
  - recoveries
  verbs:
  - create
  - delete
  - deletecollection
  - get
  - list
  - patch
  - update
  - watch
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: appscode:stash:view
  labels:
    rbac.authorization.k8s.io/aggregate-to-view: "true"
rules:
- apiGroups:
  - stash.appscode.com
  resources:
  - restics
  - recoveries
  verbs:
  - get
  - list
  - watch

---
# Source: stash/templates/cluster-role-binding.yaml

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: RELEASE-NAME-stash
  labels:
    chart: "stash-0.5.3"
    app: "stash"
    heritage: "Tiller"
    release: "RELEASE-NAME"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: RELEASE-NAME-stash
subjects:
- kind: ServiceAccount
  name: RELEASE-NAME-stash
  namespace: hub


---
# Source: stash/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: RELEASE-NAME-stash
  labels:
    app: "stash"
    chart: "stash-0.5.3"
    release: "RELEASE-NAME"
    heritage: "Tiller"
spec:
  ports:
  # Port used to expose admission webhook apiserver
  - name: admission
    port: 443
    targetPort: 8443
  # Port used to expose Prometheus pushgateway
  - name: pushgateway
    port: 56789
    protocol: TCP
    targetPort: 56789
  # Port used to expose Prometheus metrics for the operator
  - name: ops
    port: 56790
    protocol: TCP
    targetPort: 56790
  selector:
    app: "stash"
    release: "RELEASE-NAME"

---
# Source: stash/templates/deployment.yaml
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: RELEASE-NAME-stash
  labels:
    chart: "stash-0.5.3"
    app: "stash"
    heritage: "Tiller"
    release: "RELEASE-NAME"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: "stash"
      release: "RELEASE-NAME"
  template:
    metadata:
      labels:
        app: "stash"
        release: "RELEASE-NAME"
    spec:
      serviceAccountName: RELEASE-NAME-stash
      containers:
      - name: operator
        image: appscode/stash:0.7.0-rc.1
        imagePullPolicy: IfNotPresent
        args:
        - run
        - --v=3
        - --rbac=true
        - --docker-registry=
        - --secure-port=8443
        - --audit-log-path=-
        - --tls-cert-file=/var/serving-cert/tls.crt
        - --tls-private-key-file=/var/serving-cert/tls.key
        ports:
        - containerPort: 8443
        - containerPort: 56790
        readinessProbe:
          httpGet:
            path: /healthz
            port: 8443
            scheme: HTTPS
        volumeMounts:
        - mountPath: /var/serving-cert
          name: serving-cert
      - name: pushgateway
        image: 'prom/pushgateway:v0.4.0'
        imagePullPolicy: IfNotPresent
        args:
        - -web.listen-address=:56789
        - -persistence.file=/var/pv/pushgateway.dat
        ports:
        - containerPort: 56789
        volumeMounts:
        - mountPath: /var/pv
          name: data-volume
        - mountPath: /tmp
          name: stash-scratchdir
      volumes:
      - emptyDir: {}
        name: data-volume
      - emptyDir: {}
        name: stash-scratchdir
      - name: serving-cert
        secret:
          defaultMode: 420
          secretName: RELEASE-NAME-stash-apiserver-cert
---
# Source: stash/templates/apiregistration.yaml

apiVersion: apiregistration.k8s.io/v1beta1
kind: APIService
metadata:
  name: v1alpha1.admission.stash.appscode.com
  labels:
    chart: "stash-0.5.3"
    app: "stash"
    heritage: "Tiller"
    release: "RELEASE-NAME"
spec:
  group: admission.stash.appscode.com
  version: v1alpha1
  service:
    namespace: hub
    name: RELEASE-NAME-stash
  caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM5akNDQWQ2Z0F3SUJBZ0lRSmZaMVJYbndEeXVkQXBKdWxxS2UyekFOQmdrcWhraUc5dzBCQVFzRkFEQVYKTVJNd0VRWURWUVFERXdwemRtTXRZMkYwTFdOaE1CNFhEVEU0TVRJd05USXhNemMxTVZvWERUSTRNVEl3TWpJeApNemMxTVZvd0ZURVRNQkVHQTFVRUF4TUtjM1pqTFdOaGRDMWpZVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFECmdnRVBBRENDQVFvQ2dnRUJBTW0xUnBFeGl0K2F6UVk1UHBPMEdFWTJIZ1ZSb1l1NnN2U3BtWVdHbkVTRno4KzUKazJ1Y1dveUlIYzdzNVl4aFlRd2ZCZGJjbHFVcGVUczM2WHBvcXBKdHBieVRxdVVLRXhnZWVpbENsUnlXK0s5awo1YXlOU094a05vQ2pSZUIzSnFQVFJIbG4rNGxxN0pVa2VSY3oyNXNZSFM3ODRINjRNMGtvUDQxUEhKbE10YUdCCm5vSnVtUUNVaWQ4MXFwQjJjZUZLb0UzSHNtMUNWdzg4WEZJZDdOY2Jpbk1VR0FpL3V5WXd4TVZBSGpBR3k0K0kKWFZVN0xWazVJZ2NvdFVyMUxTUURXNlo5bGp2ajhIQldlbzZEbEVadU1vUVVoVzNsaC81TWpJdGt6emlTb3Y2QgpBTmJrd2gwL1N0R1l3WU9HSHU2eFkrWTFHSzBYd21OVzlGcFQ2eUVDQXdFQUFhTkNNRUF3RGdZRFZSMFBBUUgvCkJBUURBZ0trTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQkJnZ3JCZ0VGQlFjREFqQVBCZ05WSFJNQkFmOEUKQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUFhZ1NvR2VCdm5mbG5LcTlnc3k4eTZlaWJxUVE1VgpFR29pZytHMDVUL3VwdzFYZUcyaG51L3FMcWw3djZYZlFEQUVIZ0RrYmxtSFNsU0NCQ3N6MXVtSzdNZmppWnZKCkdydXgzVkx4RTAzTmgzTTRWTEh3Z3d4SFVpakxMSFNVbU05UHQvbk9OaE9nVXAydHZQdWlCTGdnd1o1eGs0ZVkKSkdkZ2ZUV2lPd2tnVWNwRm9nRHUwNGo4eGFISHpZV0pacDk0RGtxUDFqa3prMFVTVVdoamZPaXhKZldxd2RWcApicExIM0k4bmFSa21aSDV4emppWm9jWDdMWjNMbkVFQ29FTURxdWtNQXphcE9aTll0TUs0M3A2MjdwOVJnVjN4CmhHa3pBNVc3aEZuWXhSWG03OE1CSHBzVjJkQ0NNMEFBaG5iUWZYcWg2ZU5BeFdxZmVCUmV6MFczCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  groupPriorityMinimum: 10000
  versionPriority: 15
---
apiVersion: v1
kind: Secret
metadata:
  name: RELEASE-NAME-stash-apiserver-cert
  labels:
    chart: "stash-0.5.3"
    app: "stash"
    heritage: "Tiller"
    release: "RELEASE-NAME"
type: Opaque
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPakNDQWlLZ0F3SUJBZ0lRQkZiSHhFd2FHeENjSWw4LzdaaFNkekFOQmdrcWhraUc5dzBCQVFzRkFEQVYKTVJNd0VRWURWUVFERXdwemRtTXRZMkYwTFdOaE1CNFhEVEU0TVRJd05USXhNemMxTVZvWERUSTRNVEl3TWpJeApNemMxTVZvd0hURWJNQmtHQTFVRUF4TVNVa1ZNUlVGVFJTMU9RVTFGTFhOMFlYTm9NSUlCSWpBTkJna3Foa2lHCjl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF6SFlpSU5UUE9XUjNnczcxakNVZmVuYVVtQmRsZDZKMHVqOEsKYVNqaXVqNG1KcitPMmNGandXb2FaSU52VmhmMlhaNHZVbXdxN3R2akEwclNLV3VaY3dycFVKUjdUTGEyZWxzcwpFUTBrbGdLdVBHSjVrRFk5K1FLQ3EwK3dvMVA5YjhvS1FMdDk1Zmw0bkYxdmRjYTBXUitZSGtUcU9wTithMDNwClhSbGFxZ0JVbDEzZkw0dTlWRGJEeUp1QlQ2bTMyQWIrVmNqRDBBZ2JjUDRYbmFLTzdnaGFRb3dMOE50VmN6bWcKbnp6VkhGZWhrRk50N0FXMktUMVBNUHZaMVo1SUN6aW5ka0tJZWVCcjFHOFhGeUZ5UUsyVnhPZEZBT2ViYSs3MQowMjlzbXBJaWRJcnBnS3FTa2tIa1l1dXhwYTJPMkNYVCtablppVUV0SEkzNXo0c2ZTUUlEQVFBQm8zNHdmREFPCkJnTlZIUThCQWY4RUJBTUNCYUF3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdFR0NDc0dBUVVGQndNQ01Bd0cKQTFVZEV3RUIvd1FDTUFBd1BRWURWUjBSQkRZd05JSVdVa1ZNUlVGVFJTMU9RVTFGTFhOMFlYTm9MbWgxWW9JYQpVa1ZNUlVGVFJTMU9RVTFGTFhOMFlYTm9MbWgxWWk1emRtTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQkJVCitJMndZa1dTY1pzV3U2Vko0WGlXbkUrL3FDamJzdkF5YW1MUkhueWNud3FYVTVjc0xDdElUOGhXUTJFNWxEYlMKYTRDQ3VRaWZVTjNoa2tueXRPQkRxS0U0Rzd5M2NJODQxTlh2QWRNK3Ira0orT0VTeHB4OTVla3hCSVBWdEwraAoyT3FvckdvOEtPMDJuMGZtelF2bUxPZ05OT3FISUNva2syS2Y5L29yWnY1UStEc1dZdTh2dzNOWHhqNDZWdHJKCjllbWM4ejJST2lDbERROElmWUV1NlovUUFmQ283LzdnYmxvWThkbkZrTjBxMGM0TENEZGZYd0VrUlFVMXorZVkKSWJFV2tOa05hME1YWm95ZkpKd2pDVWlpMzdUd2Z1Rm5qSzZZNU9sZUo0UDkvK0dyaVZ4NGgrOTE0d2RtQndibQpsSU5MRGtZQVZwN2lBTDgyL05JPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBekhZaUlOVFBPV1IzZ3M3MWpDVWZlbmFVbUJkbGQ2SjB1ajhLYVNqaXVqNG1KcitPCjJjRmp3V29hWklOdlZoZjJYWjR2VW13cTd0dmpBMHJTS1d1WmN3cnBVSlI3VExhMmVsc3NFUTBrbGdLdVBHSjUKa0RZOStRS0NxMCt3bzFQOWI4b0tRTHQ5NWZsNG5GMXZkY2EwV1IrWUhrVHFPcE4rYTAzcFhSbGFxZ0JVbDEzZgpMNHU5VkRiRHlKdUJUNm0zMkFiK1ZjakQwQWdiY1A0WG5hS083Z2hhUW93TDhOdFZjem1nbnp6VkhGZWhrRk50CjdBVzJLVDFQTVB2WjFaNUlDemluZGtLSWVlQnIxRzhYRnlGeVFLMlZ4T2RGQU9lYmErNzEwMjlzbXBJaWRJcnAKZ0txU2trSGtZdXV4cGEyTzJDWFQrWm5aaVVFdEhJMzV6NHNmU1FJREFRQUJBb0lCQVFDYkJudEwvMjk3NmJSQQpCMkhndUFrTkZyb0dNNzhvblpINTRYQ29XV3JIb2ZYVmJXc0hxbjFUbW5xV2VaM0NYbnJiY3VRWWo1RmgrSEZBCi9zc293ci9mbllkWUpLejBkcGtYWHVlanFoNXlhMmZtdXhmSEE0bXJzMzZXRzk4bmg3aGl1WU5hbjQ2Ty83KzIKZDVYYWJDWTBhU015MkRmczRBWjduK0J3U1pnWHlyc29yVmNKMEF2Rm9rMFp0aS9zeUF4bXQrbXlWMm1tbS9zLwpFTTh0NDZ6enJXVld4amxOdk4wYS9pQlJVS0cxWFBhZ3JwRGdpYjhXVmV0Sk5ld09sUkEzVkhGNzNBL09VNno1CmRSa0JsQkkxeE10UC81VlBhR1hLeUJIb05YejVLVng3OXdRNGFCTVQyZ3lTdWQ3cnpRTVdBb3gyZHAyU055NSsKa2JxQ0lQd2RBb0dCQU54SEpDUmVXekV1cUVYQ1dLcmFHUWJ5ajNtNysrdnE3dVZrQVlESy90Y3pxYTc3NVpCTApxQWxrU3dYY2R5SmNhZEVsR21pNERKekwwb01Yb3hFM3pQMm5MRGpjNGhJTC9qbkEycndYVkE5YmR0NnRJVTZTCmd5WGVHT1huSkpXNFdmZ3c1VFZZaU45VktWZEh3OTJFRThhd1BSVnZBNWNnU3NlbHd6OCt3elRuQW9HQkFPMmUKWHdVdGtScjN0Y1FnSGQ2NUV6VHNlTVNKOTg5SlBKV2JWanJaUFdIa00zQ2NjalpIK2h6Tkh3dXhKenBDTUpKYgpRWlcvWTQydXhSTXEvdlhCR01JSHFaTUpXV1ZoT21vRkJTSEkyalhYNXI5NTJYQ3NrUG1td3ZDdm5LanlUK0FzCmllaWEvdG5DWTRZUjMvVUlWM0tHN25uU0orZ241QkZPRE01TVBsUlBBb0dCQU1nNDJmODh6UU10ZDhMQTNydWQKdHJYNzhMSWtUdDZvRXpIcTd2clVpVU92TUFOZjc5QnpGSEJFKzNSK2FzT080Smc4YzM3UUhKYkJKYjRHMURBbwpXbW9OZEVMVGM2SVh5S05TU3dCQTdDVnhhK0VIMllpRDREV2haVnhEOTVzbmtJL3FVYzFsaGpRS1FxT1ZGZEhaCjVlZnA5ZnZ2aG9IdDFrc1d2eHhUdmpmdEFvR0FVL21wU1JJdWV1SmFHWUxrSzRjcXM0Unl0YnF3bWxBZW1oeTQKbjdtUWlOejJGUEVsSit2T0I0bXlWQlo2YjR0ZTBRcHhKalBxUWZNbThMdzhPS3ZTVFJnYUpMMmtHMEQrUE9PagpTYXBLKzhaZVpRTHlCbkRtRjJTSTlqaUoyK2N1dFdIb0p3MUh6YnQySXJhRWVIdEhORkZkVEM0cUxsQ1N1RTdtCkZhNDZSTjhDZ1lCUnFIUXFWV1B0TUMxeDZLbm9IRjk4YytZU21zKzR1a1dOcE9COUp2OWd6M1dnQlRWTGZUamMKcjlzbVFOWHNuY21ISERuMW8zWUxWYmFuYy9ld1Fydk9QYUVrUWkrYmFudkcwVVd5Z3BmM2FUQW9DR3NiYXB4TQpwRUtha2lYc0ZQQnZpdUdiVEJ0WVZwMUJpTktNb2x5eU9ZOUhjeGVFTWpIcFZ4U09zRXV3bkE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---

# to read the config for terminating authentication
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: RELEASE-NAME-stash-apiserver-extension-server-authentication-reader
  namespace: kube-system
  labels:
    chart: "stash-0.5.3"
    app: "stash"
    heritage: "Tiller"
    release: "RELEASE-NAME"
roleRef:
  kind: Role
  apiGroup: rbac.authorization.k8s.io
  name: extension-apiserver-authentication-reader
subjects:
- kind: ServiceAccount
  name: RELEASE-NAME-stash
  namespace: hub
---
# to delegate authentication and authorization
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: RELEASE-NAME-stash-apiserver-auth-delegator
  labels:
    chart: "stash-0.5.3"
    app: "stash"
    heritage: "Tiller"
    release: "RELEASE-NAME"
roleRef:
  kind: ClusterRole
  apiGroup: rbac.authorization.k8s.io
  name: system:auth-delegator
subjects:
- kind: ServiceAccount
  name: RELEASE-NAME-stash
  namespace: hub

---
# Source: stash/templates/mutating-webhook-configuration.yaml


---
# Source: stash/templates/validating-webhook-configuration.yaml


